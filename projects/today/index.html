<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Todoapp.Today | Andrea Cipriani </title> <meta name="author" content="Andrea Cipriani"> <meta name="description" content="Plan today, prepare tomorrow."> <meta name="keywords" content="andreacipriani, andrea, cipriani, software, ios"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?e8675db2668bca93ea1afa4085f4d89b"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://andreacipriani.github.io.github.io/projects/today/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Andrea Cipriani </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">my favourite </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/books/">books</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/quotes/">quotes</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/movies/">movies</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Todoapp.Today</h1> <p class="post-description">Plan today, prepare tomorrow.</p> </header> <article> <p>They say that every engineer has to build a To-Do app in their life.</p> <p><a href="https://sphere-arrest-659920.framer.app/" rel="external nofollow noopener" target="_blank">Today</a> is my implementation of a To-Do app, designed by my former colleague and ping pong office rival, <a href="https://julianpanzer.com/" rel="external nofollow noopener" target="_blank">Julian Panzer</a>. It is available exclusively for macOS users and it resides discreetly on the menu bar, always within reach. It is optimized for being used entirely with the keyboard, for pro users like us ;)</p> <p>While currently available only for macOS, we might make an iOS companion app with some more time in the future.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/today-macos-480.webp 480w,/assets/img/today-macos-800.webp 800w,/assets/img/today-macos-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/today-macos.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Today for macOS" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> With a minimalist setup, focused on simplicity and efficiency, the app is fully navigatable with the keyboard. </div> <h4 id="swiftui">SwiftUI</h4> <p>Today is my first app developed using SwiftUI!</p> <p>Working with SwiftUI was a lot of fun, it facilitated rapid layout creation and made it extremely easy to build a responsive user interface through state observation. However, as anticipated, certain UI intricacies fell short in comparison to AppKit/UIKit. For example, something as simple as setting the background of a TextField to be transparent <a href="https://stackoverflow.com/questions/78035722/transparent-textfield-inside-macos-swiftui-list" rel="external nofollow noopener" target="_blank">didn’t work if such TextField was inside a List</a>.</p> <p>You can try this yourself and observe that the clear background of the TextField inside a list is not respected:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">items</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Item 1"</span><span class="p">,</span> <span class="s">"Item 2"</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">List</span> <span class="p">{</span>
                <span class="kt">ForEach</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">index</span> <span class="k">in</span>
                    <span class="kt">TextField</span><span class="p">(</span><span class="s">"Inside list"</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="n">$items</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                        <span class="o">.</span><span class="nf">textFieldStyle</span><span class="p">(</span><span class="o">.</span><span class="n">plain</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">clear</span><span class="p">)</span> <span class="c1">// NOT respected</span>
                        <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
                <span class="p">}</span><span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span>
         <span class="kt">TextField</span><span class="p">(</span><span class="s">"Outside list"</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="n">$items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">.</span><span class="nf">textFieldStyle</span><span class="p">(</span><span class="o">.</span><span class="n">plain</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">clear</span><span class="p">)</span> <span class="c1">// Respected</span>
            <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="o">.</span><span class="n">green</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <div class="caption"> An example of SwifUI having some limitations on styling a UI element. </div> <h5 id="keyboard-integration">Keyboard integration</h5> <p>Keyboard control is the main differentatior for Today and implementing it was fairly easy. The idea is to add an invisible view as the background of the parent content view, such as:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span> <span class="n">contentView</span><span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">KeyEventHandling</span><span class="p">())</span> <span class="p">}</span>
</code></pre></div></div> <p>The transparent <code class="language-plaintext highlighter-rouge">KeyEventHandling</code> NSView intercepts all keyboard events and broadcast them using the notifiation center, so that multiple views in the code base can intercept the events and react accordingly:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">KeyEventHandling</span><span class="p">:</span> <span class="kt">NSViewRepresentable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">makeNSView</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSView</span> <span class="p">{</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
      <span class="kt">KeyView</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="nf">makeFirstResponder</span><span class="p">(</span><span class="kt">KeyView</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kt">KeyView</span><span class="o">.</span><span class="n">shared</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">updateNSView</span><span class="p">(</span><span class="n">_</span> <span class="nv">nsView</span><span class="p">:</span> <span class="kt">NSView</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">KeyView</span><span class="p">:</span> <span class="kt">NSView</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">KeyView</span><span class="p">()</span>
  <span class="k">override</span> <span class="k">var</span> <span class="nv">acceptsFirstResponder</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="k">override</span> <span class="kd">func</span> <span class="nf">keyDown</span><span class="p">(</span><span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">NSEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">event</span><span class="o">.</span><span class="n">keyCode</span> <span class="p">{</span>
    <span class="c1">// For a list of mapping between keyCodes and keys check this out: https://eastmanreference.com/complete-list-of-applescript-key-codes</span>
    <span class="k">case</span> <span class="mi">53</span><span class="p">:</span>
      <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="kt">Notification</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">escKeyPressed</span><span class="p">))</span>
    <span class="k">case</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span>
      <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="kt">Notification</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">enterKeyPressed</span><span class="p">))</span>
    <span class="k">case</span> <span class="mi">126</span><span class="p">:</span>
      <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="kt">Notification</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">upKeyPressed</span><span class="p">))</span>
    <span class="c1">// etc...</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h5 id="focusing-a-textfield-programmatically">Focusing a TextField programmatically</h5> <p>One of the biggest challenge was fine-tuning TextField interactions, specifically setting it on focus after certain events like arrow navigation or shortcuts. I ended up writing a custom Text Field solution using AppKit, inspired by <a href="https://serialcoder.dev/text-tutorials/macos-tutorials/macos-programming-implementing-a-focusable-text-field-in-swiftui/" rel="external nofollow noopener" target="_blank">this article</a>.</p> <p>Then I created a central coordinator to broadcast keyboard events, using the notification center, something as simple as:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">attemptToFocusTextField</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">shouldFocusAddItem</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Many places in the app can attempt to focus the TextField. For example, when opening the Popover using a shortcut (implemented using <a href="https://github.com/soffes/HotKey/" rel="external nofollow noopener" target="_blank">Hotkey</a>), the TextField should be focused so that the user can type a new ToDo right away without using the mouse.</p> <p>Finally, the TextField implementation can react when receiving such notification and update its internal focus state:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">CustomTextFieldImplementation</span><span class="p">()</span> <span class="c1">// not showing for brevity</span>
    <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="o">.</span><span class="n">shouldFocusAddItem</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">shouldFocus</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// A @State variable that controls the focus or in editing mode</span>
        <span class="n">viewState</span><span class="o">.</span><span class="n">currentSelectedItem</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="n">viewState</span><span class="o">.</span><span class="n">currentEditedItem</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="popovers-on-macos">Popovers on macOS</h4> <p>Another challenge was generally working with a <a href="https://developer.apple.com/design/human-interface-guidelines/popovers" rel="external nofollow noopener" target="_blank">popover window</a> in the menu bar on macOS. A popover is “a transient view that appears above other content when people click or tap a control or interactive area”. Popovers are more niche and less documented than standard windows. This <a href="https://github.com/iSapozhnik/Popover" rel="external nofollow noopener" target="_blank">Popover</a> library is a great entry point to creating and customizing Popovers on macOS, I recommend it as it simplifies most of the interactions that you will probably need to work with.</p> <p>For example, creating a transparent padding between the main view containing the ToDos and the help view proved challenging, as it requires the popover view to be transparent, which is not supported “out of the box”.</p> <div class="row"> <div class="col-sm d-flex justify-content-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/today-help-480.webp 480w,/assets/img/today-help-800.webp 800w,/assets/img/today-help-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/today-help.png" class="img-fluid rounded" width="100%" height="auto" title="Today with help view" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="download-today-for-macos">Download Today for macOS</h4> <p>If you like a minimal ToDo app optimized for pro macOS users, it’s free… <a href="https://sphere-arrest-659920.framer.app/#waitlist" rel="external nofollow noopener" target="_blank">give it a try</a>!</p> </article> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"andreacipriani/andreacipriani.github.io","data-repo-id":"R_kgDOLSpVTw","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,a])=>giscusScript.setAttribute(t,a)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Andrea Cipriani. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>